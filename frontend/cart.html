<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Giỏ Hàng</title>
    <link rel="stylesheet" href="../frontend/css/cart.css">
</head>
<body>
    <!-- Giỏ hàng -->
    <div class="giaodienGioHang" id="cartSection">
        <h2 id="tieuDeGioHang">GIỎ HÀNG</h2>
        <table class="tableGioHang" id="cartTable"></table>
        <p id="totalPrice">Tổng tiền: 0 đ</p>
        <button class="mua" onclick="showPaymentForm()">Mua ngay</button>
    </div>

    <!-- Form thanh toán -->
    <div class="formThanhToan" id="paymentForm" style="display: none;">
        <h3>Thông tin thanh toán</h3>
        <form>
            <div class="form-group">
                <label for="name">Họ và tên</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label for="address">Địa chỉ</label>
                <input type="text" id="address" name="address" required>
            </div>
            <div class="form-group">
                <label for="phone">Số điện thoại</label>
                <input type="text" id="phone" name="phone" required>
            </div>
            <div class="form-group">
                <label for="paymentMethod">Phương thức thanh toán</label>
                <select id="paymentMethod" name="paymentMethod" required>
                    <option value="creditCard">Thẻ tín dụng</option>
                    <option value="cash">Thanh toán khi nhận hàng</option>
                </select>
            </div>
            <button type="submit" class="btn-submit">Thanh toán</button>
        </form>
    </div>

    <script>
        // Hàm hiển thị giỏ hàng
        function displayCart() {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            const cartTable = document.getElementById("cartTable");
            let total = 0;

            if (cart.length === 0) {
                cartTable.innerHTML = '<tr><td colspan="5" class="kqTdGH">Không có sản phẩm nào trong giỏ hàng.</td></tr>';
                document.getElementById("totalPrice").textContent = "Tổng tiền: 0 đ";
                return;
            }

            cartTable.innerHTML = cart.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;

                return `
                    <tr>
                        <td class="tdGH">
                            <img src="${item.image}" alt="${item.name}">
                            <div>
                                <p class="tenSpGh">${item.name}</p>
                                <p>Phân loại: <strong>${item.category || "Không rõ"}</strong></p>
                            </div>
                        </td>
                        <td>
                            <span class="price">${item.price.toLocaleString()} đ</span>
                            ${item.oldPrice ? `<span class="old-price">${item.oldPrice.toLocaleString()} đ</span>` : ''}
                        </td>
                        <td>
                            <div class="quantity-control">
                                <button onclick="decreaseQuantity(${index})">-</button>
                                <span>${item.quantity}</span>
                                <button onclick="increaseQuantity(${index})">+</button>
                            </div>
                        </td>
                        <td class="action-column">
                            <button class="xoa" onclick="removeItem(${index})">Xóa</button>
                            <a class="tim-tuong-tu" href="#">Tìm sản phẩm tương tự</a>
                        </td>
                        <td>
                            <span class="price">${itemTotal.toLocaleString()} đ</span>
                        </td>
                    </tr>
                `;
            }).join("");

            document.getElementById("totalPrice").textContent = "Tổng tiền: " + total.toLocaleString() + " đ";
        }

        // Hàm tăng số lượng sản phẩm
        function increaseQuantity(index) {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart[index].quantity += 1;
            localStorage.setItem("cart", JSON.stringify(cart));
            displayCart();
        }

        // Hàm giảm số lượng sản phẩm
        function decreaseQuantity(index) {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            if (cart[index].quantity > 1) {
                cart[index].quantity -= 1;
                localStorage.setItem("cart", JSON.stringify(cart));
                displayCart();
            }
        }

        // Hàm xóa sản phẩm khỏi giỏ hàng
        function removeItem(index) {
            const cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.splice(index, 1);
            localStorage.setItem("cart", JSON.stringify(cart));
            displayCart();
        }

        // Hàm hiển thị form thanh toán
        function showPaymentForm() {
            // Ẩn giỏ hàng
            document.getElementById('cartSection').style.display = 'none';
            
            // Hiển thị form thanh toán
            document.getElementById('paymentForm').style.display = 'block';
        }

        // Khi trang tải, hiển thị giỏ hàng
        window.onload = displayCart;
    </script>
</body>
</html>
